"use strict";function _defineProperty(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var n=e[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,s,n){return s&&t(e.prototype,s),n&&t(e,n),e}}(),MpHtmlParser=require("./MpHtmlParser.js"),element=function(){function t(e,s,n){_classCallCheck(this,t),e.attrs=e.attrs||{},e.children=e.children||[],this.nodeName=e.name,this.id=e.attrs.id,this._node=e,this.childNodes=[];for(var i=0;i<e.children.length;i++)e.children[i].name&&this.childNodes.push(new t(e.children[i],s+".children["+i+"]",this._context));this.attributes=this._node.attrs,this.style={};for(var r=(e.attrs.style||"").split(";"),h=0;h<r.length;h++)if(r[h].includes(":")){var a=r[h].split(":");this.style[a[0]]=a[1]}this._path=s,this._context=n,this._dirty=!1}return _createClass(t,[{key:"appendChild",value:function(e){return e.constructor==t&&(this.childNodes.push(e),this._node.children.push(e._node),e.path=this._path+".children["+(this._node.children.length-1)+"]",this._setData(),!0)}},{key:"removeChild",value:function(e){if(e.constructor!=t)return!1;var s=this.childNodes.indexOf(e);return-1!=s&&(this.childNodes.splice(s,1),this._node.children.splice(s,1),this._setData(),!0)}},{key:"replaceChild",value:function(e,s){if(e.constructor!=t)return!1;if(s.constructor!=t)return!1;var n=this.childNodes.indexOf(e);return-1!=n&&(this.childNodes[n]=s,this._node.children[n]=s._node,s.path=this._path+".children["+n+"]",!0)}},{key:"getAttribute",value:function(t){return Object.hasOwnProperty.call(this._node.attrs,t)?this._node.attrs[t]:null}},{key:"setAttribute",value:function(t,e){return this._node.attrs[t]=e,this._setData(),!0}},{key:"getStyle",value:function(t){return t=t.replace(/(A-Z)/g,"-$1").toLowerCase(),Object.hasOwnProperty.call(this.style,t)?this.style[t]:null}},{key:"setStyle",value:function(t,e){if(t=t.replace(/(A-Z)/g,"-$1").toLowerCase(),Object.hasOwnProperty.call(this.style,t)){this.style[t]=e;var s="";for(var n in this.style)s+=n+":"+this.style[n]+";";this._node.attrs.style=s}else this._node.attrs.style=(this._node.attrs.style||"")+";"+t+":"+e;return this._setData(),!0}},{key:"_search",value:function(e,s,n,i){if("text"!=e.type){if("id"==i&&e.attrs&&e.attrs.id==n)return this._nodeList.push(new t(e,s,this._context));if(("name"==i&&e.name==n||"class"==i&&e.attrs&&e.attrs.class==n)&&this._nodeList.push(new t(e,s,this._context)),e.children&&e.children.length)for(var r=e.children.length;r--;)this._search(e.children[r],s+".children["+r+"]",n,i)}}},{key:"getElementById",value:function(t){return this._nodeList=[],this._search(this._node,this._path,t,"id"),this._nodeList[0]}},{key:"getElementsByClassName",value:function(t){return this._nodeList=[],this._search(this._node,this._path,t,"class"),this._nodeList}},{key:"getElementsByTagName",value:function(t){return this._nodeList=[],this._search(this._node,this._path,t,"name"),this._nodeList}},{key:"_setData",value:function(){var t=this;this._dirty=!0,setTimeout(function(){t._dirty&&(t._context._refresh=!0,t._context.setData(_defineProperty({},t._path,t._node)),t._dirty=!1)},0)}},{key:"innerText",get:function(){return this._context.getText([this._node])},set:function(t){this._node.children=[{type:"text",text:t}],this.childNodes=[],this._setData()}},{key:"innerHTML",get:function(){return function t(e){var s="";if("text"==e.type)s+=e.text;else{s+="<"+e.name;for(var n in e.attrs)e.attrs[n]&&(s+=" "+n+'="'+e.attrs[n]+'"');if(e.children&&e.children.length){s+=">";for(var i=0;i<e.children.length;i++)s+=t(e.children[i]);s+="</"+e.name+">"}else s+="/>"}return s}(this._node)},set:function(e){this._node.children=new MpHtmlParser(e,this._context.data).parse();for(var s=0;s<this._node.children.length;s++)this._node.children[s].name&&this.childNodes.push(new t(this._node.children[s],this._path+".children["+s+"]",this._context))}}]),t}(),dom=function(){function t(e,s,n){_classCallCheck(this,t),this._nodes=e,this._path=s,this._context=n}return _createClass(t,[{key:"_search",value:function(t,e,s,n){for(var i,r=0;i=(t||[])[r];r++)if("text"!=i.type){if("id"==n&&i.attrs&&i.attrs.id==s)return this._nodeList.push(new element(i,e+"["+r+"]",this._context));("name"==n&&i.name==s||"class"==n&&i.attrs&&i.attrs.class==s)&&this._nodeList.push(new element(i,e+"["+r+"]",this._context)),this._search(i.children,e+"["+r+"].children",s,n)}}},{key:"getElementById",value:function(t){return this._nodeList=[],this._search(this._nodes,this._path,t,"id"),this._nodeList[0]}},{key:"getElementsByClassName",value:function(t){return this._nodeList=[],this._search(this._nodes,this._path,t,"class"),this._nodeList}},{key:"getElementsByTagName",value:function(t){return this._nodeList=[],this._search(this._nodes,this._path,t,"name"),this._nodeList}},{key:"createElement",value:function(t){return new element({name:t},"",this._context)}},{key:"write",value:function(t){return this._context.setData(_defineProperty({},this._path,t.constructor==Array?t:new MpHtmlParser(t,this._context.data).parse())),!0}}]),t}();module.exports=dom;